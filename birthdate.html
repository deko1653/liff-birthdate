<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ç”Ÿå¹´æœˆæ—¥å…¥åŠ›</title>
</head>
<body>

<label>ç”Ÿå¹´æœˆæ—¥ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„</label><br>
<input
  id="birthdate"
  type="text"
  inputmode="numeric"
  placeholder="ä¾‹ï¼‰1980/2/11 ã¾ãŸã¯ 1980-2-11"
>
<br><br>
<button onclick="onSubmitBirthdate()">æ±ºå®š</button>

<script>
// ==== ã‚ãªãŸã®æ—¢å­˜ã‚³ãƒ¼ãƒ‰ ====
function parseBirthdate(text) {
  const t = (text || "").replace(/\u3000/g, " ").trim();

  let m = t.match(/(19\d{2}|20\d{2})\s*å¹´\s*(\d{1,2})\s*æœˆ\s*(\d{1,2})\s*æ—¥/);
  if (m) {
    const y = Number(m[1]);
    const mo = Number(m[2]);
    const d = Number(m[3]);
    if (isValidDateParts(y, mo, d)) return { y, m: mo, d };
  }

  m = t.match(/(19\d{2}|20\d{2})\s*[\/\-.]\s*(\d{1,2})\s*[\/\-.]\s*(\d{1,2})/);
  if (m) {
    const y = Number(m[1]);
    const mo = Number(m[2]);
    const d = Number(m[3]);
    if (isValidDateParts(y, mo, d)) return { y, m: mo, d };
  }

  return null;
}

function isValidDateParts(y, mo, d) {
  const dt = new Date(y, mo - 1, d);
  return (
    dt.getFullYear() === y &&
    dt.getMonth() === mo - 1 &&
    dt.getDate() === d
  );
}

// ==== é€ä¿¡å‡¦ç† ====
function onSubmitBirthdate() {
  const raw = document.getElementById("birthdate").value;
  const parsed = parseBirthdate(raw);

  if (!parsed) {
    alert("ç”Ÿå¹´æœˆæ—¥ã‚’æ­£ã—ãå…¥åŠ›ã—ã¦ãã ã•ã„");
    return;
  }

  const y = parsed.y;
  const m = String(parsed.m).padStart(2, "0");
  const d = String(parsed.d).padStart(2, "0");
  const normalized = `${y}-${m}-${d}`;

  alert("å—ã‘å–ã£ãŸç”Ÿå¹´æœˆæ—¥ï¼š" + normalized);

  // ğŸ‘‰ ã“ã“ã§Webhooké€ä¿¡ãƒ»æ¬¡ã®è³ªå•ã¸
}
</script>

</body>
</html>
